# Αλεξάνδρεια
## Έκδοση και απαιτήσεις
- Έκδοση 1.2.3
- Το εργαλείο "Αλεξάνδρεια" έχει δοκιμαστεί σε PHP 8.1 και 10.1.38-MariaDB.
- Οι ελάχιστες απαιτήσεις όπως διαμορφώνονται από τις 3rd-party βιβλιοθήκες που ενσωματώνονται στο λογισμικό (Onelogin SAML PHP Toolkit, Simple HTML DOM) είναι:
| PHP            |  >= 7.3|
| PHP Extensions | iconv, openssl |
| PHP ini        | allow_url_fopen = 1 |
| MariaDB/Mysql  | disabled NO_ZERO_DATE SQL mode |
- Προκειμένου να ολοκληρωθεί η συλλογή δεδομένων από το Scopus, θα πρέπει το εργαλείο "Αλεξάνδρεια" να είναι εγκατεστημένο σε server που να έχει πρόσβαση στο Scopus.

## Οδηγίες εγκατάστασης

### Βήμα 1. Alexandria web
Εξάγετε το περιεχόμενο του φακέλου `web` στο σημείο όπου θα εξυπηρετείται το εργαλείο "Αλεξάνδρεια" (π.χ., στον φάκελο `/var/www/html/alexandria.upatras.gr`).

### Βήμα 2. Βιβλιοθήκες `alexandria` και `alexandria_Scimago`
Στον φάκελο `sql`, θα βρείτε δυο SQL βάσεις δεδομένων, τις οποίες πρέπει να εισάγετε:
- `alexandria_scimago`: δεν χρειάζεται επεξεργασία.
- `alexandria_db`: χρειάζεται να περάσετε τις σχολές, τα τμήματα, τα μέλη ΔΕΠ/ΕΔΙΠ του ιδρύματος καθώς και τους χρήστες του συστήματος. Υποστηρίζονται τρεις τύποι χρηστών: Διαχειριστής, Μέλος ΔΕΠ/ΕΔΙΠ, και επισκέπτης.

Τα αρχεία `scimagojr2021.sql`, `scimagojr2022.sql` και `scimagojr2023.sql` χρειάζονται μόνο για την περίπτωση αναβάθμισης από προηγούμενη έκδοση και στην περίπτωση αρχικής εγκατάστασης μπορείτε να τα αγνοήσετε.

### Βήμα 3. Ρυθμίσεις
Αφού ολοκληρώσετε τα παραπάνω βήματα, θα χρειαστεί να αντιγράψετε το αρχείο `settings.default.php` στο `settings.php` και να κάνετε τις εξής ρυθμίσεις:

#### 3.1. Στοιχεία σύνδεσης με βάσεις
- Να εισάγετε τα στοιχεία σύνδεσης με την βάση `alexandria_db`.
- Να εισάγετε τα στοιχεία σύνδεσης με την βάση `alexandria_scimago`.

#### 3.2. Στοιχεία σύνδεσης με Scopus API
Να εισάγετε τα κλειδιά που έχετε δημιουργήσει στο [Elsevier Developer Portal](https://dev.elsevier.com/):
- Τα κλειδιά `_SCOPUS_API_KEY_CORE` και `_SCOPUS_API_KEY_CITATIONS` δημιουργούνται μέσα από το [management portal](https://dev.elsevier.com/apikey/manage). To κλειδί `_SCOPUS_API_KEY_CITATIONS` θα πρέπει να έχει πρόσβαση στο Citations Overview API.
- Το κλειδί `_SCOPUS_API_KEY_SCIVAL` αφορά το SciVal API.

#### 3.3. Στοιχεία σύνδεσης με ORCID PUBLIC API
Να εισάγετε το κλειδί `_ORCID_API_CLIENT_ID` που έχετε δημιουργήσει στο [ORCID](https://orcid.org/) ή στο [ORCID SANDBOX](https://sandbox.orcid.org/). Σε παραγωγική λειτουργία θα πρέπει η τιμή του _ORCID_API_ENV να είναι "production", αλλιώς χρησιμοποιείται το sandbox orcid public api.

#### 3.4. Σύνδεση με Shibboleth
Το εργαλείο "Αλεξάνδρεια" είναι υλοποιημένο ώστε τα μέλη ΔΕΠ/ΕΔΙΠ να συνδέονται μέσω Shibboleth (SAML πρωτόκολλο) προκειμένου να τους δίνεται η πρόσβαση στο εργαλείο. Θα πρέπει να γίνουν οι παρακάτω ρυθμίσεις:
- Ορίστε την τιμή της μεταβλητής $uid_key, ώστε να παίρνετε το username/uid του χρήστη που προσπαθεί να συνδεθεί από τα δεδομένα που επιστρέφει ο IdP.
- Ρυθμίστε κατάλληλα την μεταβλητή `$emailExt` ώστε να συμφωνεί με τον πίνακα `pa_user` της βάσης (π.χ., @upatras.gr). Επίσης ρυθμίστε κατάλληλα τα πεδία `sp` και `idp` για τους service και identity providers του Shibboleth.

## Οδηγίες αναβάθμισης από τη δοκιμαστική έκδοση 22.01

Πριν την αναβάθμιση κάντε ΑΠΑΡΑΙΤΗΤΑ backup τον κώδικα της εφαρμογής και τις βάσεις δεδομένων `alexandria_db` και `alexandria_scimago`.

1. Διαγράψτε όλα τα τα αρχεία που περιλαμβάνονται στον φάκελο εγκατάστασης της Αλεξάνδρειας. Στην συνέχεια, μεταφέρετε εκεί τα περιεχόμενα του φακέλου `web`
2. Αντιγράψτε το αρχείο `default.settings.php` σε `settings.php`. Επειδή όλη η παραμετροποίηση ήταν διασκορπισμένη σε διάφορα αρχεία, θα πρέπει να τη συπληρώσετε πλέον στο αρχείο `settings.php`.
3. Εκτελέστε το αρχείο `upgrade.php` ώστε να γίνουν οι απαραίτητες αλλαγές στη βάση δεδομένων `alexandria_db`.
4. Εισάγετε στη βάση δεδομένων `alexandria_scimago` το αρχείο `scimagojr2021.sql` από τον φάκελο `sql`, ώστε να εισαχθούν τα δεδομένα του Scimago για το έτος 2021.
5. Ακολουθήστε τις οδηγίες αναβάθμισης από την έκδοση 1.0 που καταγράφονται παρακάτω.

## Οδηγίες αναβάθμισης από την έκδοση 1.0

Πριν την αναβάθμιση κάντε ΑΠΑΡΑΙΤΗΤΑ backup τον κώδικα της εφαρμογής και τις βάσεις δεδομένων `alexandria_db` και `alexandria_scimago`.

1. Διαγράψτε όλα τα αρχεία που περιλαμβάνονται στον φάκελο εγκατάστασης της Αλεξάνδρειας εκτός από το αρχείο `settings.php`. Στη συνέχεια, μεταφέρετε εκεί τα περιεχόμενα του φακέλου `web`.
2. Προσθέστε στο αρχείο `settings.php` τις δύο νέες παραμέτρους που αφορούν το ORCID και επεξηγούνται στην ενότητα 3.4.
3. Εισάγετε στη βάση δεδομένων `alexandria_scimago` το αρχείο `scimagojr2022.sql` από τον φάκελο `sql`, ώστε να εισαχθούν τα δεδομένα του Scimago για το έτος 2022.
4. Από το αρχείο `upgrade.php` εκτελέστε μόνο εκείνο το τμήμα που αφορά την αναβάθμιση από την έκδοση 1.0 στην έκδοση 1.1

## Οδηγίες αναβάθμισης από την έκδοση 1.1

Πριν την αναβάθμιση κάντε ΑΠΑΡΑΙΤΗΤΑ backup τον κώδικα της εφαρμογής και τις βάσεις δεδομένων `alexandria_db` και `alexandria_scimago`.

1. Από το αρχείο `upgrade.php` εκτελέστε μόνο εκείνο το τμήμα που αφορά την αναβάθμιση από την έκδοση 1.1 στην έκδοση 1.2

## Οδηγίες αναβάθμισης από την έκδοση 1.2.1 σε 1.2.2 ή 1.2.3

1. Μεταφέρετε τα περιεχόμενα των πιστοποιητικών του SP στο αρχείο settings.php και διαγράψτε τα από τον φάκελο uppa_core/saml/certs.
2. Μεταφέρετε τα νέα attributes από το αρχείο default.settings.php στο αρχείο settings.php

## Changelog από τη δοκιμαστική έκδοση 22.01

- Αναβάθμιση λογισμικού και βιβλιοθηκών ώστε να υπάρχει συμβατότητα με PHP 8.1
- Μεταφορά όλης της παραμετροποίησης σε ένα αρχείο settings.php
- Αλλαγή του σχήματος της Βάσης Δεδομένων προκειμένου να υποστηρίζεται η συγχώνευση/κατάργηση Τμημάτων του Ιδρύματος
- Προσθήκη βιβλιογραφικών δεδομένων (journal rankings) Scimago έτους 2021
- Συμμόρφωση με τα πρότυπα προσβασιμότητας στον Παγκόσμιο Ιστό
- Αναβάθμιση του template AdminLTE στην τελευταία έκδοση
- Διόρθωση σφαλμάτων που εντοπίστηκαν

## Changelog από την έκδοση 1.0

- Ενσωμάτωση ORCID ID στο προφίλ των μελών του Ιδρύματος
- Προσθήκη βιβλιογραφικών δεδομένων (journal rankings) Scimago έτους 2022
- Διόρθωση ζητημάτων ασφάλειας και σφαλμάτων που εντοπίστηκαν

## Changelog από την έκδοση 1.1

- Προσθήκη db logging μηχανισμού για τις κλήσεις προς το Scopus API
- Πραγματοποίηση κλήσεων προς το Scopus Citation API σε batches των 20 δημοσιεύσεων, αντί για 1 δημοσίευση ανά κλήση

## Changelog από την έκδοση 1.2.1 σε 1.2.2

- Διορθώσεις bugs
- Βελτιώσεις ασφάλειας για SAML login

## Changelog από την έκδοση 1.2.2 σε 1.2.3

- Προσθήκη .htaccess αρχείου που δεν επιτρέπει την πρόσβαση στον git φάκελο (χρειάζεται εφόσον αυτός βρίσκεται εντός του home directory του virtual host)
- Περιορισμός των τιμών που μπορεί να λάβει η GET παράμετρος lang σε en και el μόνο
